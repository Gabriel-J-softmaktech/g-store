$(document).ready(function(){
     // filter product price using product color

     function getCartItemList(){
        $.ajax({
            url: "/cart-list/",
            dataType: 'json',
            data: {'getCartItemList':0},
            beforeSend: function (){
                console.log("Loading cart items...!")
            },
            success: function(resp){
                $('#CartList').html(resp.data)
            },
            error: function(hxr, status, error){
                $('#CartList').html(status+": "+error);
            }
        });
     }
     getCartItemList();

     $("body").on("click", "#choosen-size", function(){
        const product_price = $(this).data('size-price');
        const product_id = $(this).data("product-id");
        const product_color = $(this).data('color');
        const product_size = $(this).data('size');
        const qty = $('.product-qty-'+product_id).val();

        $('.product-price').text(product_price);

        const total_product_price = parseInt(qty) * parseInt(product_price);

        // hidden cart item input field
        $(".product-unit-price-"+product_id).val(product_price); 
        $(".product-total-price-"+product_id).val(total_product_price); 
        $(".product-color-"+product_id).val(product_color); 
        $(".product-size-"+product_id).val(product_size); 

    });

    
    $("body").on("click", "#choosen-color", function(){
        var color_id = $(this).data('color');
        const product_id = $(this).attr('product-id');
        $.ajax({
            url: '/product-detail-filter/',
            dataType: 'json',
            data: {
                'color_id': color_id,
                'product_id': product_id,
            },
            beforeSend: function(){
                console.log("loading");
            },
            success: function(resp){
                $('.size-loader').html(resp.data);
            }, 
            error: function(hxr, status, error){
                alert(status+": "+error);
            }
        });
    });


    // adding to cart from product detail page
    $("body").on("submit", "#add-to-cart", function(e){
        e.preventDefault();
        const id = $(this).attr('data-id');
        const product_name = $('.product-name-'+id).val();
        const product_category = $('.product-category-'+id).val();
        const product_image = $('.product-image-'+id).val();
        const product_slug = $('.product-slug-'+id).val();
        const product_color = $('.product-color-'+id).val();
        const product_size = $('.product-size-'+id).val();
        const product_qty = $('.product-qty-'+id).val();
        const product_total_price = $('.product-total-price-'+id).val();

        if (
            product_name && product_slug 
            && product_color && product_size 
            && product_total_price && product_qty != ''){

        $.ajax({
            url: '/add-items-session-cart',
            dataType: 'json',
            data: {
                'from-product-detail-page': 'add-product-to-cart-detail-page',
                'id': id,
                'product_image': product_image,
                'product_name': product_name,
                'product_category': product_category,
                'product_slug': product_slug,
                'product_color': product_color,
                'product_size': product_size,
                'product_qty': product_qty,
                'product_total_price': product_total_price,
            },
            beforeSend: function(){
                alert('loading')
            }, 
            success: function(resp){
                $('#total-cart-item').text(" "+resp.totalsessionitem);
                $('.message').html("Item added successfully to cart")
                $('.message').css({'display': 'inline-block'});
                setTimeout(function(){
                    $('.message').fadeOut('slow');
                }, 2000);
            },
            error: function(hxr, status, error){
                alert(status+": "+error);
            }
        });


    }else{
        alert('Please select a colour and a size before attempting to add item to cart.')
    }
        
    });


    $("body").on("keyup", '#edit-qty-input', function(){
        const product_id = $(this).attr('data-id');
        const qty = $('.edit-qty-input-'+product_id).val();

        if (qty.length == 0){
            qty = $('.edit-qty-input-'+product_id).val(0);
        }
        
        $.ajax({
            url: '/update-cart-item/',
            dataType: 'json',
            data: {'id': product_id, 'qty': qty},
            success: function(resp){
                $('#CartList').html(resp.data)
            },
            error: function(hrx, status, error){
                alert(status+": "+error);
            }
        });
    });

    // add product to cart-session within product page 
    $("body").on("click", ".add-item-to-cart", function(){
        const product_id = $(this).data('id');
        $.ajax({
            url: '/add-items-session-cart',
            dataType: 'json',
            data: {
                'home-page': 'add-product',
                'id': product_id
            },
            success: function(resp){
                if (resp.data == 'authenticated'){
                    $('#auth-total-cart-item').text(" "+resp.total_cart_item)
                }
                if (resp.data == 'unauthenticated'){
                    $('#total-cart-item').text(" "+resp.total_cart_item_in_session)
                }
            },
            error: function(hrx, status, error){
                alert(status+": "+error);
            }
        });
    });

    $("body").on("click", ".remove", function(){
        const id = $(this).data('id');
        $.ajax({
            url: '/del-cart-item/',
            dataType: 'json',
            data: {
                'del-cart-item': id,
                'id': id,
            },
            beforeSend: function(){
                console.log("Removing item..!")
            },
            success: function(resp){
                if (resp.data == 200){
                    getCartItemList();
                }
            },
            error: function(hrx, status, error){
                alert(status+": "+error);
            }
        }); 
    })



});